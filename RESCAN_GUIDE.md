# 既存音楽ファイルのメタデータ更新ガイド

## 問題
既存の音楽ファイルで以下の情報が表示されない場合：
- アーティスト名
- アルバム名
- Duration（再生時間）
- アルバムアート

## 解決方法

### 方法1: Webインターフェースから再スキャン

1. ブラウザでアプリを開く
2. ホーム画面で「ライブラリをスキャン」ボタンをクリック
3. スキャンが完了するまで待つ（数秒〜数分）
4. ページをリロードして確認

### 方法2: APIを直接呼び出す

```bash
# PowerShell（Windows）
Invoke-RestMethod -Uri "http://localhost:3001/api/music/scan" -Method POST

# curl（Mac/Linux）
curl -X POST http://localhost:3001/api/music/scan
```

### 方法3: サーバー再起動

サーバーを再起動すると、自動的にスキャンが実行されます：

```bash
# サーバーを停止（Ctrl+C）
# サーバーを再起動
npm run dev
```

## スキャンの仕組み

スキャン時に以下の条件で既存ファイルを更新します：

1. **ファイルが更新された場合**
   - ファイルの更新日時がデータベースより新しい

2. **メタデータが欠落している場合**
   - Duration（再生時間）が0
   - アルバムアートがない

3. **新規ファイルの場合**
   - データベースに存在しない

## 取得される情報

- タイトル
- アーティスト名
- アルバム名
- Duration（秒数）
- ジャンル
- 年
- トラック番号
- サンプルレート（44.1kHz, 96kHz, 192kHzなど）
- ビット深度（16bit, 24bitなど）
- ビットレート
- チャンネル数（ステレオ/モノラル）
- アルバムアート（埋め込まれている場合）
- Hi-Res判定

## トラブルシューティング

### スキャンしても情報が表示されない

1. **ファイルにメタデータが埋め込まれているか確認**
   - Windowsの場合：ファイルを右クリック → プロパティ → 詳細タブ
   - メタデータがない場合は、音楽タグ編集ソフト（Mp3tag、MusicBeeなど）で追加

2. **ファイル形式が対応しているか確認**
   - 対応形式：MP3, FLAC, M4A, AAC, OGG, WAV, WMA, DSD, DSF, DFF

3. **ファイルパスに特殊文字が含まれていないか確認**
   - 日本語ファイル名は対応していますが、一部の特殊文字は問題を起こす可能性があります

4. **コンソールログを確認**
   - サーバーのコンソールに`[Music Scanner]`で始まるログが表示されます
   - エラーメッセージがあれば、それを確認

### スキャンが遅い

- 大量のファイル（数千曲以上）がある場合、スキャンに時間がかかります
- 初回スキャンは特に時間がかかりますが、2回目以降は変更されたファイルのみを処理するため高速です

## 自動スキャン

サーバーは以下のタイミングで自動的にスキャンを実行します：

1. **サーバー起動時**（起動後2秒）
2. **ファイル変更検知時**（ファイル追加・変更・削除から3秒後）

ファイル監視機能により、手動でスキャンを実行する必要はほとんどありません。
