# 同期再生機能 - クイックスタートガイド

## 🚀 5分で始める同期再生

### ステップ1: サーバーを起動

```bash
# Windowsの場合
start.bat

# Mac/Linuxの場合
./start.sh
```

サーバーが起動したら、以下のURLでアクセス可能になります：
- ローカル: `http://localhost:3000`
- ネットワーク: `http://[あなたのIP]:3000`

### ステップ2: 複数デバイスで接続

#### デバイスA (マスター)
1. ブラウザで `http://localhost:3000` を開く
2. サイドバーからプレイリストを選択
3. プレイリスト詳細画面を開く

#### デバイスB (スレーブ)
1. 別のブラウザ/タブで同じURLを開く
2. または、スマホで `http://[PCのIP]:3000` を開く

### ステップ3: 同期モードを有効化

**現在の実装では、同期モードはデフォルトでONです。**

将来的には、以下のようなUIで切り替え可能になります：
```
[設定] → [同期再生] → [ON/OFF]
```

### ステップ4: 再生開始

#### 方法1: ヘッダーの大きな再生ボタン
```
プレイリスト詳細画面
┌─────────────────────────────────┐
│ My Playlist  [▶]  ⋯            │  ← この大きな緑色のボタン
│ 10 tracks                       │
└─────────────────────────────────┘
```

#### 方法2: サイドバーのホバー再生
```
サイドバー
┌─────────────────┐
│ Playlists       │
│ ❤ Liked Songs   │
│ 📋 My Playlist [▶] │  ← ホバーで表示
│ 📋 Chill Vibes  │
└─────────────────┘
```

#### 方法3: トラック番号から再生
```
トラックリスト
┌────┬──────────────────┐
│ #  │ TITLE            │
├────┼──────────────────┤
│ 1  │ Song A           │  ← ホバーで [▶] に変化
│ 2  │ Song B           │
│ 3  │ Song C           │
└────┴──────────────────┘
```

### ステップ5: 同期を確認

✅ **成功の確認方法**:
- デバイスAで再生開始
- デバイスBも自動的に同じ曲を再生
- プログレスバーが完全に同期
- 次の曲への切り替えも同時

❌ **失敗の場合**:
- ブラウザのコンソールを開く (F12)
- `[Socket] Connected` が表示されているか確認
- `[Time Sync] Offset: XXms` が表示されているか確認

## 🎯 テストシナリオ

### シナリオ1: 基本的な同期再生
```
1. デバイスAでプレイリストを再生
2. デバイスBで同じプレイリストを開く
3. 両方のデバイスで同じ曲が同時に再生されることを確認
```

### シナリオ2: 次の曲への同期切り替え
```
1. デバイスAで曲を再生
2. 曲が終わるまで待つ
3. 両方のデバイスで同時に次の曲に切り替わることを確認
```

### シナリオ3: 一時停止/再開の同期
```
1. デバイスAで再生中
2. デバイスBで一時停止ボタンをクリック
3. デバイスAも一時停止することを確認
4. デバイスAで再生ボタンをクリック
5. デバイスBも再生再開することを確認
```

### シナリオ4: シークの同期
```
1. デバイスAで再生中
2. デバイスBでプログレスバーをドラッグ
3. デバイスAも同じ位置にシークすることを確認
```

## 🔧 トラブルシューティング

### 問題: デバイスが同期しない

**チェックリスト**:
- [ ] 両方のデバイスが同じネットワークに接続されている
- [ ] ファイアウォールがポート3000を許可している
- [ ] ブラウザのコンソールに `[Socket] Connected` が表示されている
- [ ] サーバーログに両方のデバイスの接続が表示されている

**解決方法**:
```bash
# サーバーログを確認
# 以下のようなログが表示されるはず
[Socket.io] Client connected: abc123 (IP: 192.168.1.100)
[Socket.io] Client connected: def456 (IP: 192.168.1.101)
```

### 問題: 同期がズレる

**原因**:
- ネットワーク遅延が大きい
- デバイスの処理能力が低い
- バッファサイズが小さい

**解決方法**:
```javascript
// hooks/useSocket.ts の delay パラメータを増やす
requestSyncPlay(trackId, 0, 200); // 150ms → 200ms
```

### 問題: 音が途切れる

**原因**:
- ネットワーク帯域が不足
- 同期チェックが頻繁すぎる

**解決方法**:
```javascript
// components/SyncPlaybackController.tsx
// 同期チェック頻度を下げる
if (now - lastSyncTimeRef.current > 200) { // 100ms → 200ms
  // 同期チェック
}
```

## 📊 同期精度の確認

### ブラウザコンソールでの確認

```javascript
// F12でコンソールを開く
// 以下のログが表示される

[Socket] Connected: abc123
[Time Sync] Offset: 5.23ms (RTT: 12.45ms)
[Sync Play] Scheduled in 145ms (server offset: 5.23ms)
[Sync] Drift detected: 52ms, correcting...
```

### 期待される値
- **Time Sync Offset**: ±10ms以内
- **RTT (往復遅延)**: 50ms以下
- **Drift (ズレ)**: 50ms以下で自動補正

## 🎨 UI操作ガイド

### プレイリスト詳細画面

```
┌─────────────────────────────────────────┐
│ My Playlist  [▶]  ⋯                    │ ← ヘッダー
│ 素晴らしいプレイリスト                    │
│ 10 tracks                               │
├─────────────────────────────────────────┤
│ #  TITLE         ALBUM      DURATION    │
├─────────────────────────────────────────┤
│ 1  Song A        Album X    3:45        │ ← ホバーで [▶]
│ 2  Song B        Album Y    4:12        │
│ 3  Song C        Album Z    3:28        │
└─────────────────────────────────────────┘
```

### サイドバー

```
┌─────────────────┐
│ 🎵 Spotify Clone│
├─────────────────┤
│ 🏠 Home         │
│ 📚 Your Library │
├─────────────────┤
│ 🖥️ Server       │
│ 📊 Server Status│
│ 📤 Upload Music │
│ ⚙️ Settings     │
├─────────────────┤
│ Playlists    [+]│
│ ❤ Liked Songs   │
│ 📋 My Playlist [▶]│ ← ホバーで表示
│ 📋 Chill Vibes  │
└─────────────────┘
```

## 🚀 次のステップ

1. **複数デバイスでテスト**: スマホ、タブレット、PCで同時再生
2. **ネットワーク環境を変える**: Wi-Fi、有線LAN、モバイルホットスポット
3. **遅延を測定**: ブラウザコンソールでログを確認
4. **フィードバック**: 問題があれば報告

## 📚 関連ドキュメント

- `SYNC_PLAYBACK_GUIDE.md` - 技術詳細（英語）
- `実装完了レポート.md` - 実装内容の詳細（日本語）
- `README.md` - プロジェクト全体の説明

---

**楽しい同期再生体験を！** 🎵✨
